---
# Discovery Playbook with Custom Output Paths
# This example shows how to control where discovery outputs files

- name: Infrastructure Discovery with Custom Paths
  hosts: all
  gather_facts: true
  collections:
    - wolskinet.infrastructure

  vars:
    # Option 1: Output relative to current directory
    # discovery_base_dir: "./discovered-infrastructure"
    
    # Option 2: Output to absolute path
    # discovery_base_dir: "/home/{{ ansible_user }}/ansible-discovered"
    
    # Option 3: Output relative to playbook directory
    discovery_base_dir: "{{ playbook_dir }}/../../discovered-infrastructure"

  tasks:
    - name: Show where files will be created
      ansible.builtin.debug:
        msg:
          - "Discovery will output to:"
          - "  Inventory: {{ discovery_base_dir }}/inventory/host_vars/{{ inventory_hostname }}.yml"
          - "  Playbook: {{ discovery_base_dir }}/playbooks/{{ inventory_hostname }}_discovered.yml"
      run_once: true

    - name: Run infrastructure discovery
      ansible.builtin.include_role:
        name: discovery
      vars:
        discovery:
          inventory_dir: "{{ discovery_base_dir }}/inventory"
          playbooks_dir: "{{ discovery_base_dir }}/playbooks"
          generate_configs: true
          include_sensitive: false
          timeout: 300