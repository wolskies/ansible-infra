---
# Test the refactored dotfiles role
- name: Test Smart Dotfiles Role
  hosts: localhost
  gather_facts: true
  connection: local

  vars:
    # Use the discovered dotfiles repo from our earlier discovery
    dotfiles_repository_url: "ssh://git@gitlab.wolskinet.com:2222/configs/dotfiles.git"
    dotfiles_branch: "main"
    dotfiles_scan_for_dependencies: true
    dotfiles_auto_install_dependencies: false  # Just discover, don't install for testing
    dotfiles_prefer_system_packages: true

  tasks:
    - name: Test dotfiles role with discovery
      ansible.builtin.include_role:
        name: roles/dotfiles

    - name: Display what was discovered
      ansible.builtin.debug:
        msg:
          - "=== Dotfiles Discovery Test Results ==="
          - "Repository: {{ dotfiles_repository_url }}"
          - "Tools referenced: {{ dotfiles_referenced_tools | default([]) | join(', ') }}"
          - "Tools available: {{ dotfiles_available_tools | default([]) | join(', ') }}"
          - "Tools needed: {{ dotfiles_needed_tools | default([]) | join(', ') }}"