---
dependency:
  name: galaxy
driver:
  name: docker
platforms:
  - name: ubuntu-packages-test
    image: geerlingguy/docker-ubuntu2404-ansible:latest
    pre_build_image: true
    privileged: true
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:rw
    cgroupns_mode: host
    command: "/lib/systemd/systemd"
  - name: debian-packages-test
    image: geerlingguy/docker-debian12-ansible:latest
    pre_build_image: true
    privileged: true
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:rw
    cgroupns_mode: host
    command: "/lib/systemd/systemd"
provisioner:
  name: ansible
  inventory:
    group_vars:
      all:
        ansible_user: root
        molecule_test: true
        # Test package configuration using infrastructure structure
        infrastructure:
          host:
            packages:
              present:
                all:
                  Ubuntu:
                    - curl
                    - wget
                    - git
                    - htop
                    - vim
                  Debian:
                    - curl
                    - wget
                    - git
                    - htop
                    - vim
                group:
                  Ubuntu: []
                  Debian: []
                host:
                  Ubuntu: []
                  Debian: []
              remove:
                all:
                  Ubuntu:
                    - nano # Test package removal
                  Debian:
                    - nano
                group:
                  Ubuntu: []
                  Debian: []
                host:
                  Ubuntu: []
                  Debian: []
              apt:
                apt_cache:
                  update_cache: true
                  valid_time: 3600
                system_upgrade:
                  enable: false
                  type: safe
                repositories:
                  all:
                    Ubuntu: []
                    Debian: []
                  group:
                    Ubuntu: []
                    Debian: []
                  host:
                    Ubuntu: []
                    Debian: []
    host_vars:
      ubuntu-packages-test:
        # Complete infrastructure structure with Ubuntu-specific packages
        infrastructure:
          host:
            packages:
              present:
                all:
                  Ubuntu:
                    - curl
                    - wget
                    - git
                    - htop
                    - vim
                  Debian:
                    - curl
                    - wget
                    - git
                    - htop
                    - vim
                group:
                  Ubuntu: []
                  Debian: []
                host:
                  Ubuntu:
                    - tree
                    - jq
                  Debian: []
              remove:
                all:
                  Ubuntu:
                    - nano
                  Debian:
                    - nano
                group:
                  Ubuntu: []
                  Debian: []
                host:
                  Ubuntu: []
                  Debian: []
              apt:
                apt_cache:
                  update_cache: true
                  valid_time: 3600
                system_upgrade:
                  enable: false
                  type: safe
                repositories:
                  all:
                    Ubuntu: []
                    Debian: []
                  group:
                    Ubuntu: []
                    Debian: []
                  host:
                    Ubuntu:
                      - name: "test-ppa"
                        types: "deb"
                        uris: "http://ppa.launchpad.net/git-core/ppa/ubuntu"
                        suites: "{{ ansible_distribution_release }}"
                        components: "main"
                        signed_by: "https://keyserver.ubuntu.com/pks/lookup?op=get&search=0xE1DD270288B4E6030699E45FA1715D88E1DF1F24"
                        state: present
                    Debian: []
      debian-packages-test:
        # Complete infrastructure structure with Debian-specific packages
        infrastructure:
          host:
            packages:
              present:
                all:
                  Ubuntu:
                    - curl
                    - wget
                    - git
                    - htop
                    - vim
                  Debian:
                    - curl
                    - wget
                    - git
                    - htop
                    - vim
                group:
                  Ubuntu: []
                  Debian: []
                host:
                  Ubuntu: []
                  Debian:
                    - tree
                    - jq
              remove:
                all:
                  Ubuntu:
                    - nano
                  Debian:
                    - nano
                group:
                  Ubuntu: []
                  Debian: []
                host:
                  Ubuntu: []
                  Debian: []
              apt:
                apt_cache:
                  update_cache: true
                  valid_time: 3600
                system_upgrade:
                  enable: true
                  type: safe
                repositories:
                  all:
                    Ubuntu: []
                    Debian: []
                  group:
                    Ubuntu: []
                    Debian: []
                  host:
                    Ubuntu: []
                    Debian: []
  config_options:
    defaults:
      host_key_checking: false
      stdout_callback: ansible.builtin.default
      stdout_callback_format: yaml
verifier:
  name: ansible
