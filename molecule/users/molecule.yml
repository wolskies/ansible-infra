---
dependency:
  name: galaxy
driver:
  name: docker
platforms:
  - name: ubuntu-users-test
    image: geerlingguy/docker-ubuntu2404-ansible:latest
    pre_build_image: true
    privileged: true
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:rw
    cgroupns_mode: host
    command: "/lib/systemd/systemd"
  - name: debian-users-test
    image: geerlingguy/docker-debian12-ansible:latest
    pre_build_image: true
    privileged: true
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:rw
    cgroupns_mode: host
    command: "/lib/systemd/systemd"
provisioner:
  name: ansible
  config_options:
    defaults:
      host_key_checking: false
      remote_tmp: /tmp/.ansible/tmp
      stdout_callback: ansible.builtin.default
      stdout_callback_format: yaml
  inventory:
    group_vars:
      all:
        # Enable consistent behavior for molecule tests
        molecule_test: true
    host_vars:
      ubuntu-users-test:
        # Test comprehensive user management
        users:
          # Basic user
          - name: testuser1
            uid: 1001
            groups: []
            shell: /bin/bash
            comment: "Test User One"
            create_home: true
          # User with multiple groups
          - name: testuser2
            uid: 1002
            groups: [sudo, adm, systemd-journal]
            shell: /bin/zsh
            comment: "Test User Two - Admin"
            create_home: true
          # System user (low UID)
          - name: testservice
            uid: 999
            groups: [www-data]
            shell: /usr/sbin/nologin
            comment: "Service Account"
            create_home: false
          # User with dotfiles configuration
          - name: devuser
            uid: 1003
            groups: [docker]
            shell: /bin/bash
            comment: "Developer User"
            create_home: true
            dotfiles:
              enable: false # Skip in container test
              repo: "https://github.com/example/dotfiles"
              branch: "main"

      debian-users-test:
        # Test different user configurations on Debian
        users:
          # Standard user
          - name: debianuser
            uid: 1001
            groups: [sudo]
            shell: /bin/bash
            comment: "Debian Test User"
            create_home: true
          # User modification test (existing vs new)
          - name: nobody
            # Test modifying existing system user
            comment: "Modified Nobody User"
            shell: /bin/bash
          # Test edge cases
          - name: longusernametest
            uid: 1999
            groups: []
            shell: /bin/dash
            comment: "User with long name and uncommon shell"
            create_home: true
verifier:
  name: ansible
