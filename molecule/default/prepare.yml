---
- name: Prepare test container
  hosts: all
  gather_facts: false
  tasks:
    - name: Wait for container to be ready
      ansible.builtin.wait_for_connection:
        delay: 2
        timeout: 30

    - name: Install essential packages
      ansible.builtin.apt:
        name:
          - python3
          - python3-pip
          - sudo
        state: present
        update_cache: true
      failed_when: false

    - name: Gather facts after preparation
      ansible.builtin.setup:
