---
dependency:
  name: galaxy
driver:
  name: docker
platforms:
  # Test Docker installation
  - name: ubuntu24-docker-test
    image: geerlingguy/docker-ubuntu2404-ansible:latest
    pre_build_image: true
    privileged: true
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:rw
    cgroupns_mode: host
    command: "/lib/systemd/systemd"
  # Test Docker service deployment
  - name: debian12-docker-service
    image: geerlingguy/docker-debian12-ansible:latest
    pre_build_image: true
    privileged: true
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:rw
    cgroupns_mode: host
    command: "/lib/systemd/systemd"
provisioner:
  name: ansible
  config_options:
    defaults:
      remote_tmp: /tmp/ansible-remote-tmp
      local_tmp: /tmp/ansible-local-tmp
      host_key_checking: false
      stdout_callback: ansible.builtin.default
      stdout_callback_format: yaml
  inventory:
    group_vars:
      all:
        molecule_test: true
        ansible_managed: "Managed by Ansible - do not edit manually"
        docker_services_root: "/opt/docker-services"
        # Skip Docker service management in containers
        docker_service_state: stopped
        docker_service_enabled: false
        docker_restart_on_failure: false
    host_vars:
      ubuntu24-docker-test:
        # Test basic Docker installation
        test_docker_only: true
      debian12-docker-service:
        # Test Docker service deployment
        service_name: "nginx-test"
        service_enabled: true
        service_use_proxy: false
        service_env_vars:
          NGINX_PORT: "8080"
          NGINX_HOST: "0.0.0.0"
        compose_file_content: |
          image: nginx:alpine
          container_name: nginx-test
          restart: unless-stopped
          ports:
            - "${NGINX_PORT}:80"
          volumes:
            - ./data:/usr/share/nginx/html:ro
verifier:
  name: ansible
