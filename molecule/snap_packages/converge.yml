---
- name: Test snap package management functionality
  hosts: all
  become: true
  gather_facts: true
  tasks:
    # Phase 1: Install snap packages
    - name: Apply snap package management role (install)
      ansible.builtin.include_role:
        name: wolskinet.infrastructure.manage_snap_packages
      tags:
        - snap-packages
        - install-snap

    # Phase 2: Test removal functionality
    - name: Configure snap for removal testing
      ansible.builtin.set_fact:
        snap_packages:
          management_action: "remove"
          packages:
            install:
              - hello-world
            classic: []
          remove:
            all_packages: true
            system_packages: false # Keep snapd installed for testing
            disable_services: true
            cleanup_directories: false
            cleanup_path: false
          purge:
            confirm: false

    - name: Apply snap package management role (remove)
      ansible.builtin.include_role:
        name: wolskinet.infrastructure.manage_snap_packages
      tags:
        - snap-packages
        - remove-snap
