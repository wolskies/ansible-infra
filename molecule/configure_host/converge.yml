---
# Test playbook for configure_host role
- name: Test configure_host role
  hosts: all
  gather_facts: true
  become: true

  pre_tasks:
    - name: Update package cache
      ansible.builtin.package:
        update_cache: true
      when: ansible_pkg_mgr in ['apt']

  tasks:
    - name: Include configure_host role
      ansible.builtin.include_role:
        name: wolskinet.infrastructure.configure_host

    - name: Test with different configurations
      ansible.builtin.include_role:
        name: wolskinet.infrastructure.configure_host
      vars:
        config_hostname: "custom-hostname"
        config_ubuntu_disable_snap: true
        config_journal: true
        config_journal_max_size: "100M"
        config_sysctl: true
        config_sysctl_params:
          net.core.somaxconn: 65535
          vm.swappiness: 5
      when: ansible_distribution == "Ubuntu"

    - name: Test Debian-specific features
      ansible.builtin.include_role:
        name: wolskinet.infrastructure.configure_host
      vars:
        config_debian_unattended_upgrades: true
        config_unattended_email: "admin@example.com"
      when: ansible_distribution == "Debian"