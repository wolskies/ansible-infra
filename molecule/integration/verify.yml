---
- name: Verify integration test results
  hosts: all
  gather_facts: false
  tasks:
    - name: Verify packages were installed
      ansible.builtin.command: which {{ item }}
      loop:
        - curl
        - wget
        - htop
      changed_when: false

    - name: Verify user was created
      ansible.builtin.user:
        name: testuser
        state: present
      register: user_check
      check_mode: true

    - name: Validate user exists
      ansible.builtin.assert:
        that:
          - not user_check.changed
        fail_msg: "User testuser should exist"

    - name: Check system configuration files
      ansible.builtin.stat:
        path: "{{ item }}"
      loop:
        - /etc/systemd/timesyncd.conf
      register: config_files

    - name: Validate configuration files exist
      ansible.builtin.assert:
        that:
          - item.stat.exists
        fail_msg: "Configuration file {{ item.item }} should exist"
      loop: "{{ config_files.results }}"