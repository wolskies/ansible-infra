---
# Simple prepare for discovery testing
- name: Prepare discovery test environment
  hosts: discovery_targets
  gather_facts: true
  tasks:
    - name: Create test users with different UIDs
      ansible.builtin.user:
        name: "{{ item.name }}"
        uid: "{{ item.uid }}"
        shell: "{{ item.shell }}"
        create_home: true
      loop:
        - { name: testuser1, uid: 1500, shell: /bin/bash }
        - { name: testuser2, uid: 1501, shell: /bin/zsh }
        - { name: sysuser, uid: 999, shell: /bin/false }  # Below UID threshold

    - name: Create .dotfiles directories for test users
      ansible.builtin.file:
        path: "/home/{{ item }}/.dotfiles"
        state: directory
        owner: "{{ item }}"
        mode: '0755'
      loop:
        - testuser1
        - testuser2
      ignore_errors: true