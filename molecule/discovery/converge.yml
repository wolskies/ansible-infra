---
# Test infrastructure discovery utility
- name: Test infrastructure discovery
  hosts: discovery_targets
  gather_facts: true
  collections:
    - wolskinet.infrastructure
  
  tasks:
    - name: Create discovery output directory
      ansible.builtin.file:
        path: "{{ discovery_output_path }}"
        state: directory
        mode: '0755'
      delegate_to: localhost

    - name: Run infrastructure discovery role
      ansible.builtin.include_role:
        name: wolskinet.infrastructure.discovery
      vars:
        discovery:
          output_dir: "{{ discovery_output_path }}"
          generate_configs: true
          include_sensitive: false
          timeout: 120

    - name: Display discovery completion
      ansible.builtin.debug:
        msg: "Infrastructure discovery completed for {{ inventory_hostname }}"