---
# =============================================================================
# UNIFIED INFRASTRUCTURE CONFIGURATION
# =============================================================================
# This example shows how to configure all infrastructure settings in one place
# Each role will pick out the settings it needs from this unified structure
# =============================================================================

# -----------------------------------------------------------------------------
# SYSTEM-LEVEL CONFIGURATION (requires sudo/admin)
# -----------------------------------------------------------------------------
infrastructure:
  Ubuntu:
    # OS Configuration (os_configuration role)
    hostname: ""
    domain: "example.com"
    timezone: "America/New_York"
    locale: "en_US.UTF-8"
    language: "en_US.UTF-8"
    update_hosts: true

    # Time synchronization
    ntp:
      enabled: true
      servers:
        - 0.pool.ntp.org
        - 1.pool.ntp.org

    # System logging
    journal:
      configure: true
      max_size: "500M"
      max_retention: "30d"

    # Service management
    services:
      enable: [systemd-timesyncd]
      disable: [bluetooth, cups]

    # Kernel parameters
    sysctl:
      parameters:
        vm.swappiness: 10
        net.core.default_qdisc: "fq"

    # Resource limits
    limits:
      limits:
        - domain: '*'
          limit_type: soft
          limit_item: nofile
          value: 65536

    # Package Management (manage_packages role)
    packages:
      all: [git, vim, htop, curl, wget]
      remove: [snap, snapd]
      repositories:
        all:
          - name: docker
            types: deb
            uris: "https://download.docker.com/linux/ubuntu"
            suites: "{{ ansible_distribution_release }}"
            components: stable
            signed_by: "https://download.docker.com/linux/ubuntu/gpg"
      settings:
        apt_cache:
          update_cache: true
          valid_time: 3600

    # Security Services (manage_security_services role)
    firewall:
      enabled: false
      prevent_ssh_lockout: true
      package: "ufw"
      rules:
        - rule: allow
          port: 22
          proto: tcp
          comment: "SSH"
        - rule: allow
          port: 80
          proto: tcp
          comment: "HTTP"
        - rule: allow
          port: 443
          proto: tcp
          comment: "HTTPS"

    fail2ban:
      enabled: false
      sender: "root@localhost"
      dest_email: "admin@example.com"
      services:
        - name: sshd
          enabled: true
          maxretry: 3
          bantime: 3600

    # Ubuntu-specific settings
    snap:
      remove_completely: true
    unattended_upgrades:
      enabled: true
      email: "admin@example.com"
      auto_reboot: false
    apt:
      no_recommends: true

  Debian:
    # Similar structure to Ubuntu
    hostname: ""
    domain: "example.com"
    timezone: "America/New_York"
    # ... rest of Debian settings

  Archlinux:
    # Arch-specific structure
    hostname: ""
    domain: "example.com"
    timezone: "America/New_York"
    # ... Arch settings
    packages:
      all: [git, vim, htop]
      settings:
        enable_aur: true
        aur_helper: paru
    pacman:
      multilib: true
      no_confirms: false

  Darwin:
    # macOS-specific structure
    hostname: ""
    domain: "local"
    timezone: "America/New_York"
    computer_name: "MacBook Pro"

    # macOS updates
    updates:
      auto_check: true
      auto_download: false

    # Security
    gatekeeper:
      enabled: true

    # Packages via Homebrew
    packages:
      all: [git, vim, htop, wget]
      casks:
        all: [visual-studio-code, docker, firefox]
      settings:
        update_homebrew: true
        cleanup_cache: false
        taps: [homebrew/cask-fonts]

# -----------------------------------------------------------------------------
# USER CONFIGURATION (user-scope, including account management)
# -----------------------------------------------------------------------------
users:
  - username: alice
    state: present
    groups: [sudo, docker]
    shell: /bin/bash
    ssh_pubkey: "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5... alice@example.com"
    password: "$6$salt$encryptedhash"  # or plaintext to be hashed

    # User preferences per distribution
    Ubuntu:
      git:
        name: "Alice Smith"
        email: "alice@example.com"
        editor: "vim"
      dotfiles:
        - src: bashrc.j2
          dest: .bashrc
        - src: vimrc.j2
          dest: .vimrc

    Darwin:
      git:
        name: "Alice Smith"
        email: "alice@example.com"
      dock:
        tile_size: 48
        autohide: true
        minimize_to_application: true
      finder:
        ShowExtensions: true
        ShowHidden: true
        ShowPathbar: true
      system:
        KeyRepeat: 2
        InitialKeyRepeat: 15

  - username: bob
    state: present
    groups: [users]
    ssh_pubkey: "ssh-rsa AAAAB3NzaC1yc2... bob@example.com"

    Ubuntu:
      git:
        name: "Bob Jones"
        email: "bob@example.com"

  - username: olduser
    state: absent  # This user will be removed
