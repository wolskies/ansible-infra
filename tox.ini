[tox]
envlist = py{39,310,311,312}-ansible{6,7,8}
skipsdist = True

[gh-actions]
python =
    3.9: py39
    3.10: py310
    3.11: py311
    3.12: py312

[testenv]
deps =
    ansible6: ansible>=6.0,<7.0
    ansible7: ansible>=7.0,<8.0  
    ansible8: ansible>=8.0,<9.0
    pytest
    pytest-testinfra
    molecule[docker]
    docker
    pyyaml
    jinja2

setenv =
    ANSIBLE_FORCE_COLOR=1
    ANSIBLE_HOST_KEY_CHECKING=False
    PY_COLORS=1

commands =
    # Run integration tests
    pytest tests/integration/ -v
    
    # Run molecule tests for basic scenarios
    molecule test -s basic_setup
    
[testenv:lint]
deps =
    ansible-lint
    yamllint
    flake8
    bandit
    safety

commands =
    # Ansible linting
    ansible-lint .
    
    # YAML linting
    yamllint .
    
    # Python linting
    flake8 --max-line-length=120 tests/
    
    # Security scanning
    bandit -r tests/
    safety check

[testenv:docs]
deps =
    sphinx
    sphinx-rtd-theme
    ansible-doc-extractor

commands =
    sphinx-build -b html docs/ docs/_build/html

[testenv:performance]
deps = {[testenv]deps}
commands =
    # Run performance-focused molecule tests
    molecule test -s default

[flake8]
max-line-length = 120
exclude = 
    .git,
    __pycache__,
    .tox,
    venv,
    env,
    .env

[yamllint]
extends = default
rules:
  line-length:
    max: 120
  indentation:
    spaces: 2
  truthy:
    allowed-values: ['true', 'false', 'on', 'off']