#cloud-config
hostname: ${hostname}
manage_etc_hosts: true

users:
  - name: ${ansible_user}
    groups: [sudo]
    sudo: ALL=(ALL) NOPASSWD:ALL
    shell: /bin/bash
    ssh_authorized_keys:
      - ${ssh_public_key}

package_update: true
package_upgrade: false

packages:
  - python3
  - python3-apt
  - python3-debian
  - sudo
  - curl
  - gnupg
  - lsb-release
  - ca-certificates
  - systemd
  - qemu-guest-agent

runcmd:
  - curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sudo -u ${ansible_user} sh -s -- -y --default-toolchain stable
  - echo "export PATH=\"\$HOME/.cargo/bin:\$PATH\"" >> /home/${ansible_user}/.bashrc
  - systemctl enable ssh
  - systemctl start ssh
