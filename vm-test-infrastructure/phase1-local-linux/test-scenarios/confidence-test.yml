---
# Phase I Confidence Test Scenario
# Tests functionality that couldn't be tested in containers
# Focuses on Debian 12 and Ubuntu 22.04 specific features

# OS Configuration - test features skipped in containers
host_hostname: "{{ inventory_hostname }}"
host_update_hosts: true
host_locale: en_US.UTF-8
host_timezone: America/New_York

# Firewall configuration (from manage_security_services role)
firewall:
  enabled: true
  prevent_ssh_lockout: true
  package: "ufw"
  stealth_mode: false
  block_all: false
  logging: false
  rules:
    - rule: allow
      port: 22
      proto: tcp
      comment: "SSH access"
    - rule: allow
      port: 80
      proto: tcp
      comment: "HTTP"

# User configuration with full capabilities
users:
  - name: testdev
    comment: "Test Developer"
    state: present
    groups:
      - sudo
    shell: /bin/bash
    create_home: true
    ssh_keys:
      - "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAITestKeyForVMTesting test@vm"

# Package management - test OS-specific variations
# Disable repository management for confidence test
apt:
  repositories:
    all: {}
    group: {}
    host: {}

packages:
  present:
    host:
      Debian:
        - build-essential
        - git
        - curl
        - wget
        - neovim
        - tmux
        - htop
        - python3-pip
        - python3-venv
      Ubuntu:
        - build-essential
        - git
        - curl
        - wget
        - neovim
        - tmux
        - htop
        - python3-pip
        - python3-venv

# Language environments - using correct role variable formats
# NodeJS configuration for nodejs role
node_user: testdev
node_packages:
  - yarn
  - prettier
node_version: "20"

# Rust configuration for rust role
rust_user: testdev
rust_components:
  - rustfmt
  - clippy
rust_packages: [] # Debian 12 has rustup pre-installed via cloud-init

# Go configuration for go role
go_user: testdev
go_version: "1.21.5"

# Terminal configuration - test terminfo compilation
terminal_config:
  install_terminfo: true
  terminals:
    - alacritty
    - kitty

# Security services configuration (fail2ban)
fail2ban:
  enabled: true
  sender: "root@localhost"
  dest_email: ""
  defaults:
    bantime: 3600
    findtime: 600
    maxretry: 5
  services:
    - name: sshd
      enabled: true
      maxretry: 3
      bantime: 3600
      findtime: 600
      logpath: /var/log/auth.log
  ignoreips:
    - "127.0.0.1/8"
    - "::1"

# UFW firewall configuration
ufw:
  enabled: true
  default_policy: deny
  rules:
    - { rule: allow, port: 22, proto: tcp, comment: "SSH" }
    - { rule: allow, port: 80, proto: tcp, comment: "HTTP" }

# Snap and Flatpak configuration - test removal
snap:
  remove_snap: true

flatpak:
  install: false
