---
- name: Converge
  hosts: all
  gather_facts: true
  tasks:
    - name: Create test user
      ansible.builtin.user:
        name: rusttest
        state: present
        create_home: true
      become: true

    - name: Test rust role with packages
      ansible.builtin.include_role:
        name: wolskinet.infrastructure.rust
      vars:
        rust_user: rusttest
        rust_packages:
          - ripgrep
          - bat

    - name: Test rust role idempotency
      ansible.builtin.include_role:
        name: wolskinet.infrastructure.rust
      vars:
        rust_user: rusttest
        rust_packages:
          - ripgrep
          - bat
