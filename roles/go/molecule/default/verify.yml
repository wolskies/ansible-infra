---
- name: Verify
  hosts: all
  gather_facts: true
  tasks:
    - name: Check if go is available
      ansible.builtin.command: go version
      become: true
      become_user: gotest
      register: go_version
      changed_when: false

    - name: Verify go version format
      ansible.builtin.assert:
        that:
          - go_version.stdout is match("^go version go[0-9]+\\.[0-9]+")
        fail_msg: "Go version format is incorrect: {{ go_version.stdout }}"

    - name: Verify go install command works
      ansible.builtin.command: go env GOPATH
      become: true
      become_user: gotest
      register: go_path
      changed_when: false

    - name: Verify GOPATH is set
      ansible.builtin.assert:
        that:
          - go_path.stdout | length > 0
        fail_msg: "GOPATH is not set or empty"
