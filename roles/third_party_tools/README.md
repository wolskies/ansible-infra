# Third-Party Packages Role

This role handles all packages and software that require additional setup beyond standard OS repositories:

- **Repository configuration** (APT, Homebrew taps, etc.)
- **Third-party system packages** (from configured repositories)
- **Python packages** (via pip)
- **Node.js packages** (via npm)
- **Rust packages** (via cargo)
- **Go packages** (via go install)

## Architecture

This role consolidates what used to be separate concerns:
- Repository management (moved from `basic_setup`)
- npm packages (consolidated from `npm_packages` role)
- pip packages (consolidated from `python_packages` role)

## Usage

### Basic Usage
```yaml
- name: Install third-party packages
  hosts: all
  roles:
    - name: wolskinet.infrastructure.third_party_packages
      vars:
        pip_packages:
          - black
          - ruff
        npm_packages:
          - prettier
          - eslint
```

### With Repository Configuration
```yaml
- name: Install packages requiring additional repositories
  hosts: all
  vars:
    # Configure repositories first
    additional_repositories:
      apt:
        sources:
          - "deb https://nvidia.github.io/libnvidia-container/stable/ubuntu24.04/$(ARCH) /"
        keys:
          - url: "https://nvidia.github.io/libnvidia-container/gpgkey"
            name: "nvidia-container-toolkit"
    
    # Then install packages
    third_party_packages:
      - nvidia-container-toolkit
    
    pip_packages:
      - torch
      - torchvision
    
    npm_packages:
      - "@angular/cli"
      - typescript
  
  roles:
    - wolskinet.infrastructure.third_party_packages
```

### Discovery Integration
Works seamlessly with the discovery role output:

```yaml
# Generated by discovery
third_party_packages:
  - docker-ce
  - nvidia-container-toolkit

pip_packages:
  - black
  - ruff

npm_packages:
  - prettier
  - eslint

third_party_package_sources:
  docker-ce: "https://download.docker.com/linux/ubuntu"
  nvidia-container-toolkit: "https://nvidia.github.io/libnvidia-container"
```

## Variables

### Repository Configuration
```yaml
additional_repositories:
  apt:
    sources:
      - "deb [arch=amd64] https://example.com/repo stable main"
    keys:
      - url: "https://example.com/key.gpg"
        name: "example-repo"
  homebrew:
    taps:
      - "homebrew/cask-fonts"
  flatpak:
    remotes:
      - name: "flathub"
        url: "https://flathub.org/repo/flathub.flatpakrepo"
```

### Package Lists
```yaml
# System packages from third-party repositories
third_party_packages:
  - docker-ce
  - code
  - google-chrome-stable

# Python packages
pip_packages:
  - black
  - ruff
  - mypy
pip_install_method: "user"  # user, global, virtualenv

# Node.js packages  
npm_packages:
  - prettier
  - eslint
  - typescript
npm_install_global: true

# Rust packages (cargo install)
rust_packages:
  - ripgrep
  - fd-find
enable_rust_packages: true

# Go packages (go install)
go_packages:
  - github.com/junegunn/fzf@latest
enable_go_packages: true
```

### Feature Toggles
```yaml
enable_repositories: true
enable_python_packages: true
enable_npm_packages: true
enable_rust_packages: false  # Disabled by default
enable_go_packages: false    # Disabled by default
```

## Installation Methods

### Python Packages
- **`user`**: Install to user directory (default, safest)
- **`global`**: Install system-wide (not recommended)
- **`virtualenv`**: Install to virtual environment

### Node.js Packages
- **Global**: Install globally with `-g` flag
- **Local**: Install to current directory/project

## Tags

- `repositories`: Repository configuration only
- `system-packages`: Third-party system packages
- `python`, `pip`: Python package installation
- `nodejs`, `npm`: Node.js package installation
- `rust`, `cargo`: Rust package installation
- `golang`, `go`: Go package installation
- `third-party-packages`: All third-party package operations

## Examples

### Development Environment
```yaml
third_party_packages:
  - code          # VS Code
  - docker-ce     # Docker

pip_packages:
  - black         # Python formatter
  - ruff          # Python linter
  - mypy          # Type checker

npm_packages:
  - prettier      # Code formatter
  - eslint        # JavaScript linter
  - typescript    # TypeScript compiler
```

### GPU Workstation
```yaml
additional_repositories:
  apt:
    sources:
      - "deb https://nvidia.github.io/libnvidia-container/stable/ubuntu24.04/$(ARCH) /"
    keys:
      - url: "https://nvidia.github.io/libnvidia-container/gpgkey"
        name: "nvidia-container-toolkit"

third_party_packages:
  - nvidia-container-toolkit

pip_packages:
  - torch
  - torchvision
  - jupyter
```

### Cross-Platform Development
```yaml
# macOS
additional_repositories:
  homebrew:
    taps:
      - "homebrew/cask-fonts"

# Works on all platforms
pip_packages:
  - black
  - ruff
npm_packages:
  - prettier
  - eslint
```

## Integration

This role is designed to work in the standard flow:
1. **`basic_setup`**: OS packages, users, system configuration
2. **`third_party_packages`**: Additional repositories and packages
3. **`dotfiles`**: User configuration files

The role integrates perfectly with the discovery system to recreate existing machine configurations.