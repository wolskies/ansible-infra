---
- name: Check to see if basic packages are installed
  community.general.pacman:
    name: "{{ dotfiles_archlinux_packages }}"
    state: present
  become: yes
  vars:
    dotfiles_archlinux_packages: >-
      {{
        ['git', 'stow', 'zoxide', 'eza', 'fzf'] +
        (['starship'] if dotfiles_starship_enable | default(false) else [])
      }}

- name: Create starship configuration directory
  ansible.builtin.file:
    path: "{{ ansible_env.HOME }}/.config"
    state: directory
    mode: '0755'
  when:
    - dotfiles_starship_enable | default(false)
    - dotfiles_starship_create_config | default(true)

- name: Deploy starship configuration
  ansible.builtin.copy:
    content: "{{ dotfiles_starship_config }}"
    dest: "{{ ansible_env.HOME }}/.config/starship.toml"
    mode: '0644'
  when:
    - dotfiles_starship_enable | default(false)
    - dotfiles_starship_create_config | default(true)
    - dotfiles_starship_config is defined
    - dotfiles_starship_config | length > 0

