# Group variables for {{ item }}
# Generated from infrastructure discovery on {{ ansible_date_time.iso8601 }}
# Compatible with existing ~/Ansible/inventory structure

---
{% if item == 'workstations' %}
# Workstations Configuration - matches workstations.yml format
group_roles_install:
{% if discovery_profile.desktop.environment %}
  - desktop-{{ discovery_profile.desktop.environment | lower }}
{% else %}
  - desktop-hyprland  # Default from existing config
{% endif %}

{% elif item == 'docker_hosts' %}
# Docker Hosts Configuration - matches docker_hosts/vars.yml format
group_packages_install: 
  - curl 
  - openssh-server
  - ca-certificates

group_services_remove: []

group_services_remove_Debian: []

group_roles_include:
  - docker_role

{% elif item == 'infra' %}
# Infrastructure hosts configuration
group_roles_install:
  - basic_setup
  - system_update

# Security configuration for infrastructure hosts
enable_hardening: true
enable_firewall: true

{% elif item.endswith('_hosts') and item.startswith(('gitlab', 'nextcloud', 'paperless', 'nginx', 'apache')) %}
# Application-specific host group: {{ item }}
group_roles_install:
  - basic_setup
  - system_update
{% if item.startswith(('gitlab', 'nextcloud', 'paperless')) %}
  - docker_role
{% endif %}

{% if item.startswith('nginx') %}
# Nginx-specific configuration
nginx_sites_detected: {{ discovery_profile.service_configs.nginx_sites | length }}
{% endif %}

{% if item.startswith('apache') %}
# Apache-specific configuration  
apache_sites_detected: {{ discovery_profile.service_configs.apache_sites | length }}
{% endif %}

{% else %}
# Generic group configuration for {{ item }}
group_roles_install:
  - basic_setup
  - system_update

{% endif %}

# TODO: Review and customize role assignments
# TODO: Add vault.yml file for sensitive variables
# TODO: Verify compatibility with existing roles