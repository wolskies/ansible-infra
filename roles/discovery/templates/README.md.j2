# Infrastructure Discovery Report

**Source**: {{ discovered_machine.hostname | default(inventory_hostname) }} ({{ discovered_machine.type | default('unknown') }})  
**Date**: {{ discovered_machine.discovered_at | default(ansible_date_time.iso8601) }}  
**OS**: {{ discovered_system.os.distribution | default('Unknown') }} {{ discovered_system.os.version | default('') }}

## Discovery Results

**Packages**: {{ discovered_packages.total | default(0) }} found

**Services**: {{ discovered_services.running | default([]) | length }} running

{% if discovered_docker is defined and discovered_docker.installed | default(false) %}
**Docker**: Installed
- Compose: {{ 'Available' if discovered_docker.compose.available | default(false) else 'Not available' }}
- Services found: {{ discovered_docker.services.total | default(0) if discovered_docker.services is defined else 0 }}
{% if discovered_docker.services is defined and discovered_docker.services.canned is defined %}
- Canned services: {{ discovered_docker.services.canned_roles | default([]) | join(', ') }}
{% endif %}
{% if discovered_docker.services is defined and discovered_docker.services.generic is defined %}
- Generic services: {{ discovered_docker.services.generic | default([]) | length }}
{% endif %}
{% endif %}


{% if discovered_dotfiles.users_with_dotfiles | default([]) | length > 0 %}
**Dotfiles**: Found for {{ discovered_dotfiles.users_with_dotfiles | default([]) | length }}/{{ discovered_dotfiles.total_users_scanned | default(0) }} users
{% if discovered_dotfiles.primary_dotfiles is defined and discovered_dotfiles.primary_dotfiles.repository_detected | default(false) %}
- Primary: {{ discovered_dotfiles.primary_dotfiles.user | default('unknown') }} (repository: {{ discovered_dotfiles.primary_dotfiles.repository_url | default('') }})
{% elif discovered_dotfiles.primary_dotfiles is defined and discovered_dotfiles.primary_dotfiles.local_configs_detected | default(false) %}
- Primary: {{ discovered_dotfiles.primary_dotfiles.user | default('unknown') }} (local configs)
{% endif %}
{% endif %}

## Generated Files

- `host_vars/{{ inventory_hostname }}.yml` - Host-specific variables for your inventory
- `{{ inventory_hostname }}_discovered.yml` - Deployment playbook for this host

## Next Steps

1. Review generated host_vars file for accuracy
2. Uncomment desired roles in the deployment playbook
3. Configure vault variables for sensitive data
4. Deploy: `ansible-playbook {{ inventory_hostname }}_discovered.yml`

## File Locations

The discovery role respects your ansible.cfg configuration:
- Host variables: Added to your configured inventory directory
- Playbook: Created in your configured playbooks directory