---
# Global Variables for All Hosts
# Generated by wolskinet.infrastructure.discovery role
# Compatible with existing ansible collection structure

# User configuration
ansible_user: '{{ discovered_users.current_user.name }}'

# System configuration
config_system_locale: 'en_US.UTF-8'
config_system_language: 'en_US.UTF-8'
config_system_timezone: 'America/New_York'  # TODO: Update for your timezone

# User details (add vault-encrypted passwords)
user_details:
  - name: '{{ discovered_users.current_user.name }}'
    uid: {{ discovered_users.current_user.uid }}
    gid: {{ discovered_users.current_user.gid }}
    password: '$6$REPLACE_WITH_VAULT_VARIABLE$'  # TODO: Set vault_user_password
{% if discovered_users.shell_config.preferred_shell != '/bin/bash' %}
    shell: '{{ discovered_users.shell_config.preferred_shell }}'
{% endif %}

{% if discovered_users.dotfiles.detected and discovered_users.dotfiles.repository_url %}
# Dotfiles configuration
dotfiles_repository_url: '{{ discovered_users.dotfiles.repository_url }}'
{% if discovered_users.dotfiles.current_branch %}
dotfiles_branch: '{{ discovered_users.dotfiles.current_branch }}'
{% endif %}
install_dotfiles: true

{% endif %}
{% if not discovered_desktop.has_gui %}
# Security hardening (for servers)
# DevSec Hardening Role Overrides
os_users_without_password_ageing:
  - '{{ discovered_users.current_user.name }}'
os_mnt_var_log_group: "root"

# Firewall configuration
ufw_manage_defaults: true
ufw_enable_ipv6: false
network_ipv6_enable: false

{% if discovered_security.ssh.settings.port is defined and discovered_security.ssh.settings.port != '22' %}
# SSH configuration (discovered settings)
ssh_server_ports: ["{{ discovered_security.ssh.settings.port }}"]
ssh_client_port: "{{ discovered_security.ssh.settings.port }}"
{% else %}
# SSH configuration (secure defaults)
ssh_server_ports: ["22"]
ssh_client_port: "22"
{% endif %}

# SSH security settings
ssh_use_dns: true
ssh_allow_tcp_forwarding: "yes"
ssh_allow_agent_forwarding: true
ssh_x11_forwarding: false
ssh_use_pam: true
sshd_authenticationmethods: publickey

# System security
sysctl_overwrite:
  net.ipv4.ip_forward: 1
  network_ipv6_enable: false
  ssh_use_pam: true
  os_auth_pw_max_age: 99999

{% endif %}
# Machine classification (for conditional logic)
discovered_machine_type: '{{ discovered_machine.type }}'
discovered_machine_groups: {{ discovered_machine.groups }}

# TODO: Review and update timezone
# TODO: Set vault_user_password in vault.yml
# TODO: Customize security settings as needed