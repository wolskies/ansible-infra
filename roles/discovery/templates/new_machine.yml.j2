---
# New Machine Deployment Playbook
# Generated by wolskinet.infrastructure.discovery
# Source: {{ discovered_machine.hostname | default(inventory_hostname) }} ({{ discovered_machine.type | default('unknown') }})

- name: Deploy discovered configuration
  hosts: {{ inventory_hostname }}
  gather_facts: true
  
  roles:
    # Uncomment roles as needed:
    #
    # - wolskinet.infrastructure.basic_setup
{% if discovered_docker is defined and discovered_docker.installed | default(false) %}
    # - geerlingguy.docker  # Install Docker
    # - wolskinet.infrastructure.container_platform  # Basic Docker setup + Portainer
{% for role in discovered_docker.services.canned_roles | default([]) %}
    # - wolskinet.infrastructure.{{ role }}  # Discovered {{ role }} service
{% endfor %}
{% endif %}
{% if discovered_dotfiles.users_with_dotfiles | default([]) | length > 0 %}  
    # - wolskinet.infrastructure.dotfiles  # Found dotfiles for {{ discovered_dotfiles.users_with_dotfiles | length }} user(s)
{% endif %}
    # - wolskinet.infrastructure.maintenance
{% if discovered_machine.type | default('') == 'server' %}
    # - devsec.hardening.os_hardening
    # - devsec.hardening.ssh_hardening
    # - wolskinet.infrastructure.system_security
{% endif %}