---
# New Machine Deployment Playbook
# Generated by wolskinet.infrastructure.discovery
# Source: {{ discovered_machine.hostname | default(inventory_hostname) }} ({{ discovered_machine.type | default('unknown') }})

- name: Deploy discovered configuration
  hosts: {{ inventory_hostname }}
  gather_facts: true
  
  roles:
    # Uncomment roles as needed:
    #
    # - wolskinet.infrastructure.basic_setup
{% if discovered_docker is defined and discovered_docker.installed | default(false) %}
    # - geerlingguy.docker  # Install Docker
    # - wolskinet.infrastructure.container_platform  # Basic Docker setup + Portainer
{% if discovered_docker.compose_services.canned | default([]) | length > 0 %}
    # Discovered services with dedicated roles:
{% for service in discovered_docker.compose_services.canned %}
    # - wolskinet.infrastructure.{{ service.role }}  # {{ service.name }} at {{ service.directory }}
{% endfor %}
{% endif %}
{% if discovered_docker.compose_services.generic | default([]) | length > 0 %}
    # Generic Docker Compose services discovered:
{% for service in discovered_docker.compose_services.generic %}
    # - wolskinet.infrastructure.generic_docker_service  # {{ service.name }} at {{ service.directory }}
{% endfor %}
{% endif %}
{% endif %}
{% if discovered_dotfiles.users_with_dotfiles | default([]) | length > 0 %}  
    # - wolskinet.infrastructure.dotfiles  # Found dotfiles for {{ discovered_dotfiles.users_with_dotfiles | length }} user(s)
{% endif %}
    # - wolskinet.infrastructure.maintenance
{% if discovered_machine.type | default('') == 'server' %}
    # - devsec.hardening.os_hardening
    # - devsec.hardening.ssh_hardening
    # - wolskinet.infrastructure.system_security
{% endif %}