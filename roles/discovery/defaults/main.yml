---
# Infrastructure discovery and inventory generation
# Supports: Ubuntu 22+, Debian 12+, Arch Linux, macOS

# =============================================================================
# DISCOVERY BEHAVIOR
# =============================================================================

discovery_generate_configs: true
discovery_timeout: 300
discovery_debug: false

# =============================================================================
# DOCKER DISCOVERY
# =============================================================================

discovery_docker_compose_paths:
  - "/opt"
  - "/opt/docker"
  - "/srv"
  - "/srv/docker"
  - "/home/*/docker"

discovery_docker_service_mapping:
  "gitlab/gitlab-ce": "gitlab"
  "gitlab/gitlab-ee": "gitlab"
  "ghcr.io/paperless-ngx/paperless-ngx": "paperless"
  "paperless-ngx/paperless-ngx": "paperless"
  "jellyfin/jellyfin": "jellyfin"
  "jc21/nginx-proxy-manager": "nginx_proxy_manager"
  "ghcr.io/gethomepage/homepage": "homepage"
  "benphelps/homepage": "homepage"
  "portainer/portainer-ce": "portainer"
  "portainer/portainer-ee": "portainer"

# =============================================================================
# SYSTEM DETECTION
# =============================================================================

discovery_shell_configuration:
  supported_shells:
    - /bin/bash
    - /bin/zsh
    - /usr/bin/fish
  config_files:
    bash: [.bashrc, .bash_profile, .profile]
    zsh: [.zshrc, .zsh_profile, .profile]
    fish: [.config/fish/config.fish]

discovery_repository_detection:
  apt:
    keys_paths:
      - "/etc/apt/trusted.gpg.d"
      - "/usr/share/keyrings"
    gpg_key_mapping:
      "docker.com": "https://download.docker.com/linux/{{ ansible_distribution | lower}}/gpg"
      "deb.gierens.de": "https://raw.githubusercontent.com/eza-community/eza/main/deb.asc"
      "packages.gitlab.com": "https://packages.gitlab.com/runner/gitlab-runner/gpgkey"
      "nvidia.github.io": "https://nvidia.github.io/libnvidia-container/gpgkey"
      "apt.postgresql.org": "https://www.postgresql.org/media/keys/ACCC4CF8.asc"
      "packages.redis.io": "https://packages.redis.io/gpg"
      "download.opensuse.org": "https://download.opensuse.org/repositories/home:/ungoogled_chromium/Ubuntu_22.04/Release.key"
      "deb.nodesource.com": "https://deb.nodesource.com/gpgkey/nodesource.gpg.key"
      "packages.microsoft.com": "https://packages.microsoft.com/keys/microsoft.asc"
      "dl.google.com": "https://dl.google.com/linux/linux_signing_key.pub"
      "ppa.launchpad.net": null
  pacman:
    config: "/etc/pacman.conf"
    mirrorlist: "/etc/pacman.d/mirrorlist"
  aur_helpers: [yay, paru, trizen]
  homebrew:
    paths:
      - "/opt/homebrew/bin/brew"
      - "/usr/local/bin/brew"

discovery_dotfiles_detection:
  repository_indicators:
    - .dotfiles
    - .config
  management_tools:
    - Makefile
    - install.sh
    - bootstrap.sh
    - setup.sh
    - stow
    - .stow-local-ignore

# =============================================================================
# OUTPUT TEMPLATE DEFAULTS
# =============================================================================

discovery_system_tuning_defaults:
  gaming:
    enabled: false
    description: "Gaming optimizations (kernel parameters, CPU governor, etc.)"
    kernel_params: ["mitigations=off"]
    cpu_governor: "performance"
  gpu:
    enabled: false
    description: "GPU-specific configurations and drivers"
    nvidia_support: false
    amd_support: false
    intel_support: false
  bluetooth:
    enabled: false
    description: "Bluetooth support and audio codecs"
    audio_codecs: ["aptx", "ldac", "aac"]
  camera:
    enabled: false
    description: "Camera/webcam support and permissions"
    v4l2_support: true
  audio:
    enabled: false
    description: "Audio system optimizations"
    low_latency: false
    real_time_audio: false
  security:
    ssh_hardening: false
    firewall_strict: false
    fail2ban: false
  network:
    performance_tuning: false
    tcp_optimization: false

discovery_user_configuration_defaults:
  primary_user:
    sudo_nopasswd: false
    additional_groups: []
    docker_access: false
  shell:
    default_shell: "/bin/bash"
  ssh:
    key_management: false
    disable_password_auth: false

# =============================================================================
# PACKAGE FILTERING
# =============================================================================

discovery_infrastructure_packages:
  docker:
    - "docker-ce"
    - "docker-ce-cli"
    - "docker-compose-plugin"
    - "containerd.io"
    - "docker.io"
    - "docker-compose"
  nvidia:
    - "nvidia-container-toolkit"
    - "libnvidia-container*"
    - "nvidia-container-runtime"
  gitlab:
    - "gitlab-runner"

discovery_infrastructure_patterns:
  - "^libnvidia-.*"
  - "^nvidia-driver-.*"
  - "^docker-.*-plugin$"

# =============================================================================
# LEGACY COMPATIBILITY
# =============================================================================

# Deprecated - use individual variables above
discovery:
  generate_configs: true
  timeout: 300
  debug: false

discovery_docker_compose_dir: "/opt/docker"

repository_detection:
  pacman:
    config: "/etc/pacman.conf"
    mirrorlist: "/etc/pacman.d/mirrorlist"
  aur_helpers: [yay, paru, trizen]
  homebrew:
    paths:
      - "/opt/homebrew/bin/brew"
      - "/usr/local/bin/brew"
