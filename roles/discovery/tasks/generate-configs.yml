---
# Configuration File Generation - Simplified
# Generates host_vars and playbook in user's configured ansible directories

- name: Generate host-specific variables
  ansible.builtin.template:
    src: "host_vars.yml.j2"
    dest: "{{ discovery_paths.inventory_dir }}/host_vars/{{ inventory_hostname }}.yml"
    mode: '0644'
  delegate_to: localhost
  tags:
    - generation
    - host_vars

- name: Generate deployment playbook
  ansible.builtin.template:
    src: "new_machine.yml.j2"
    dest: "{{ discovery_paths.playbooks_dir }}/{{ inventory_hostname }}_discovered.yml"
    mode: '0644'
  delegate_to: localhost
  tags:
    - generation
    - playbooks

- name: Display generation summary
  ansible.builtin.debug:
    msg:
      - "=== Configuration Files Generated ==="
      - "Host variables: {{ discovery_paths.inventory_dir }}/host_vars/{{ inventory_hostname }}.yml"
      - "Deployment playbook: {{ discovery_paths.playbooks_dir }}/{{ inventory_hostname }}_discovered.yml"
      - "Discovery README: {{ discovery_paths.inventory_dir }}/README_{{ inventory_hostname }}_discovery.md"
      - ""
      - "Next steps:"
      - "1. Review generated host_vars file"
      - "2. Configure vault variables for sensitive data"
      - "3. Run deployment: ansible-playbook {{ discovery_paths.playbooks_dir }}/{{ inventory_hostname }}_discovered.yml"
  tags:
    - generation
    - summary
