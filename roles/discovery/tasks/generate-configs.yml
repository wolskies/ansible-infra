---
# Configuration File Generation - Simplified
# Only generates essential files that exist and are used

- name: Generate core configuration files
  ansible.builtin.template:
    src: "inventory.yml.j2"
    dest: "{{ discovery.output_dir }}/inventory.yml"
    mode: '0644'
  delegate_to: localhost
  tags:
    - generation
    - core

- name: Generate host-specific configuration files
  ansible.builtin.template:
    src: "{{ item.src }}"
    dest: "{{ discovery.output_dir }}/{{ item.dest }}"
    mode: '0644'
  loop:
    - src: "host_vars.yml.j2"
      dest: "host_vars/{{ inventory_hostname }}.yml"
  delegate_to: localhost
  tags:
    - generation
    - host_vars

- name: Generate playbook
  ansible.builtin.template:
    src: "new_machine.yml.j2"
    dest: "{{ discovery.output_dir }}/playbooks/new_machine.yml"
    mode: '0644'
  delegate_to: localhost
  tags:
    - generation
    - playbooks

- name: Display generation summary
  ansible.builtin.debug:
    msg:
      - "=== Configuration Files Generated ==="
      - "Files created in: {{ discovery.output_dir }}"
      - "  - inventory.yml"
      - "  - host_vars/{{ inventory_hostname }}.yml"
      - "  - playbooks/new_machine.yml"
      - ""
      - "Next steps:"
      - "1. Review generated files"
      - "2. Configure vault variables for sensitive data"
      - "3. Run: ansible-playbook -i inventory.yml playbooks/new_machine.yml"
  tags:
    - generation
    - summary