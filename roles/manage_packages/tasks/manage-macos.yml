---
# macOS package management - Homebrew packages, taps, and casks

# Setup Homebrew - must come before package installation
- name: Setup Homebrew
  ansible.builtin.include_tasks: manage-homebrew.yml
  tags:
    - homebrew
    - packages

# =============================================================================
# HOMEBREW PACKAGES (CLI tools and libraries)
# =============================================================================

- name: Install packages via Homebrew
  community.general.homebrew:
    name: "{{ merged_packages_install }}"
    state: present
  when: merged_packages_install | length > 0
  vars:
    merged_packages_install: >-
      {{
        (vars.get('all_packages_install_' + ansible_distribution, []) | default([])) +
        (vars.get('group_packages_install_' + ansible_distribution, []) | default([])) +
        (vars.get('host_packages_install_' + ansible_distribution, []) | default([]))
        | unique | sort
      }}
