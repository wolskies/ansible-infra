---
# Package variable merging - ONLY for package install/remove lists
# Merges: all_packages_install_* + group_packages_install_* + host_packages_install_*
# All other variables use Ansible's standard precedence rules

# =============================================================================
# PACKAGE INSTALL LISTS - OS-SPECIFIC MERGING
# =============================================================================

- name: Merge package install lists
  ansible.builtin.set_fact:
    final_packages_install: >-
      {{
        (vars['all_packages_install_' + ansible_distribution] | default([])) +
        (vars['group_packages_install_' + ansible_distribution] | default([])) +
        (vars['host_packages_install_' + ansible_distribution] | default([])) | unique
      }}
  tags:
    - packages
    - merge

- name: Merge package removal lists
  ansible.builtin.set_fact:
    final_packages_remove: >-
      {{
        (vars['all_packages_remove_' + ansible_distribution] | default([])) +
        (vars['group_packages_remove_' + ansible_distribution] | default([])) +
        (vars['host_packages_remove_' + ansible_distribution] | default([])) | unique
      }}
  tags:
    - packages
    - merge

# =============================================================================
# PACKAGE EXCLUSIONS - Remove packages from install list
# =============================================================================

- name: Apply package exclusions
  ansible.builtin.set_fact:
    final_packages_install: "{{ final_packages_install | difference(final_packages_remove) }}"
  tags:
    - packages
    - merge
