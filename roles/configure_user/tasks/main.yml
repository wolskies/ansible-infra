---
# Configure user preferences for all users in infrastructure.domain.users
- name: Validate required variables
  ansible.builtin.assert:
    that:
      - infrastructure.domain.users is defined
      - infrastructure.domain.users | length > 0
    fail_msg: "configure_user role requires infrastructure.domain.users to be defined and non-empty"

- name: Configure user preferences
  ansible.builtin.include_tasks: configure-user-single.yml
  vars:
    current_user_config: "{{ user }}"
  loop: "{{ infrastructure.domain.users }}"
  loop_control:
    loop_var: user
  when: user.name != 'root' # Skip system accounts
  tags:
    - user-config
