---
# Configure preferences for a single user (called from main.yml loop)

- name: Configure cross-platform user preferences for {{ current_user_config.name }}
  ansible.builtin.include_tasks: configure-cross-platform.yml
  tags:
    - user-config
    - cross-platform

- name: Configure OS-specific user preferences for {{ current_user_config.name }}
  ansible.builtin.include_tasks: configure-{{ ansible_system }}.yml
  when: current_user_config[ansible_distribution] is defined
  tags:
    - user-config
    - os-specific

- name: Configure dotfiles for {{ current_user_config.name }}
  ansible.builtin.include_role:
    name: wolskinet.infrastructure.dotfiles
  vars:
    dotfiles:
      user: "{{ current_user_config.name }}"
      repository_url: "{{ current_user_config.dotfiles.repository }}"
      repository_branch: "{{ current_user_config.dotfiles.branch | default('main') }}"
      method: "{{ current_user_config.dotfiles.method | default('stow') }}"
      stow_packages: "{{ current_user_config.dotfiles.packages | default([]) }}"
  when: current_user_config.dotfiles is defined and current_user_config.dotfiles.enable | default(true)
  tags:
    - user-config
    - dotfiles
