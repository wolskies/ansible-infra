---
# macOS Application Layer Firewall management
# Limited port management capabilities on macOS

- name: macOS firewall configuration
  block:
    - name: Display macOS firewall limitation notice
      ansible.builtin.debug:
        msg:
          - "macOS Application Layer Firewall has limited port-based configuration"
          - "Most port management is handled automatically by applications"
          - "Manual port configuration requires pfctl or third-party tools"
          - "Firewall role will skip detailed port configuration on macOS"
      when: 
        - firewall_ports is defined and firewall_ports | length > 0
      tags:
        - firewall
        - macos
        - info

    - name: Enable macOS firewall logging (if requested)
      ansible.builtin.command: log config --subsystem com.apple.alf --mode "level:{{ 'debug' if firewall_logging else 'off' }}"
      become: true
      when: firewall_logging is defined
      changed_when: true
      ignore_errors: true
      tags:
        - firewall
        - macos
        - logging

  rescue:
    - name: Handle macOS firewall configuration errors
      ansible.builtin.debug:
        msg: "macOS firewall configuration encountered errors. This is expected for detailed port management."
      tags:
        - debug
        - firewall
        - error-handling

  tags:
    - firewall
    - macos
    - alf