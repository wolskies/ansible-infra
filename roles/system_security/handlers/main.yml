---
# System Security role handlers
# Handles security service reloads across different systems

# Firewall handlers
- name: reload ufw
  ansible.builtin.systemd:
    name: ufw
    state: reloaded
  become: true
  listen: "reload ufw"

- name: reload firewalld
  ansible.builtin.systemd:
    name: firewalld
    state: reloaded
  become: true
  listen: "reload firewalld"

- name: restart firewall
  ansible.builtin.service:
    name: "{{ firewall_service_name }}"
    state: restarted
  become: true
  vars:
    firewall_service_name: >-
      {%- if ansible_distribution in ['Ubuntu', 'Debian'] -%}
      ufw
      {%- elif ansible_distribution == 'Archlinux' -%}
      firewalld
      {%- else -%}
      firewall
      {%- endif -%}
  listen: "restart firewall"

# Fail2ban handlers
- name: restart fail2ban
  ansible.builtin.service:
    name: fail2ban
    state: restarted
  become: true
  listen: "restart fail2ban"

- name: reload fail2ban
  ansible.builtin.service:
    name: fail2ban
    state: reloaded
  become: true
  listen: "reload fail2ban"