---
- name: Validate required variables
  ansible.builtin.assert:
    that:
      - terminal_user is defined
      - terminal_user | length > 0
      - terminal_entries is defined
      - terminal_entries | length > 0
    fail_msg: "terminal_config role requires terminal_user and terminal_entries variables"

- name: Configure terminal emulators for {{ terminal_user }}
  block:
    - name: Ensure user terminfo directory exists
      ansible.builtin.file:
        path: "~/.terminfo"
        state: directory
        mode: "0755"

    - name: Configure each terminal emulator
      ansible.builtin.include_tasks: configure_terminal.yml
      vars:
        terminal_name: "{{ terminal_item }}"
        terminal_config: "{{ terminal_configs[terminal_item] }}"
      loop: "{{ terminal_entries }}"
      loop_control:
        loop_var: terminal_item
        label: "{{ terminal_item }}"
  become: true
  become_user: "{{ terminal_user }}"
