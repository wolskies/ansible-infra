---
# Default Docker Compose template for {{ service.name }}
# This is used when no specific template exists for a service

version: '3.8'

services:
  {{ service.name }}:
    image: {{ service.image }}
    container_name: {{ service.name }}
    restart: {{ docker_default_resources.restart_policy }}
{% if service.ports | length > 0 %}
    ports:
{% for port in service.ports %}
      - "{{ port }}"
{% endfor %}
{% endif %}
{% if service.environment | length > 0 %}
    environment:
{% for key, value in service.environment.items() %}
      {{ key }}: "{{ value }}"
{% endfor %}
{% endif %}
{% if service.volumes | length > 0 %}
    volumes:
{% for volume in service.volumes %}
      - {{ volume }}
{% endfor %}
{% endif %}
    deploy:
      resources:
        limits:
          memory: {{ docker_default_resources.memory }}
          cpus: '{{ docker_default_resources.cpus }}'
{% if service.networks | length > 0 %}
    networks:
{% for network in service.networks %}
      - {{ network }}
{% endfor %}
{% endif %}

{% if service.networks | length > 0 %}
networks:
{% for network in service.networks %}
  {{ network }}:
    external: true
{% endfor %}
{% endif %}