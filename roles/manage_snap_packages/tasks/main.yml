---
# manage_snap_packages role main tasks

- name: Disable and remove snap system (primary use case)
  ansible.builtin.include_tasks: disable-snap.yml
  when:
    - ansible_os_family == "Debian"
    - infrastructure.host.snap is defined
    - infrastructure.host.snap.disable_and_remove | default(false)
  tags:
    - snap-packages

- name: Manage specific snap packages (when snap system is enabled)
  ansible.builtin.include_tasks: manage-packages.yml
  when:
    - ansible_os_family == "Debian"
    - infrastructure.host.snap is defined
    - not (infrastructure.host.snap.disable_and_remove | default(false))
    - infrastructure.host.snap.packages is defined
    - >-
      (infrastructure.host.snap.packages.install | default([]) | length > 0) or
      (infrastructure.host.snap.packages.remove | default([]) | length > 0)
  tags:
    - snap-packages
