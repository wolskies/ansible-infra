---
# manage_snap_packages role main tasks

- name: Validate supported OS versions
  ansible.builtin.fail:
    msg: >-
      {{ ansible_distribution }} {{ ansible_distribution_version }}
      is not supported for snap management. Supported: Ubuntu 22+, Debian 12+
  when:
    - ansible_os_family == "Debian"
    - >-
      (ansible_distribution == "Ubuntu" and ansible_distribution_major_version | int < 22) or
      (ansible_distribution == "Debian" and ansible_distribution_major_version | int < 12)
  tags:
    - always
    - validation
    - snap-packages

- name: Skip snap management on non-Debian systems
  ansible.builtin.debug:
    msg: "Skipping snap management on {{ ansible_distribution }} - snap is Ubuntu/Debian specific"
  when: ansible_os_family != "Debian"
  tags:
    - snap-packages

- name: Disable and remove snap system (primary use case)
  ansible.builtin.include_tasks: disable-snap.yml
  when:
    - ansible_os_family == "Debian"
    - snap.disable_and_remove | default(true)
  tags:
    - snap-packages

- name: Manage specific snap packages (when snap system is enabled)
  ansible.builtin.include_tasks: manage-packages.yml
  when:
    - ansible_os_family == "Debian"
    - not (snap.disable_and_remove | default(true))
    - >-
      (snap.packages.install | default([]) | length > 0) or
      (snap.packages.remove | default([]) | length > 0)
  tags:
    - snap-packages
