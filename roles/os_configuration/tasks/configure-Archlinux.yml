# REQ-OS-021: Pacman Proxy Configuration
- name: Configure Pacman proxy
  ansible.builtin.lineinfile:
    path: /etc/pacman.conf
    regexp: "^#?Server.*/$repo/os/$arch"
    insertafter: "^\\[options\\]"
    line: "Server = {{ pacman.proxy }}/$repo/os/$arch"
    state: present
  become: true
  when:
    - pacman.proxy is defined
    - pacman.proxy | length > 0
  tags:
    - pacman

# Removed state-based behavior - only configure when requested

# REQ-OS-021a: Pacman NoConfirm Configuration
- name: Configure Pacman NoConfirm
  ansible.builtin.lineinfile:
    path: /etc/pacman.conf
    regexp: "^#?NoConfirm"
    line: "NoConfirm"
    state: present
  become: true
  when:
    - pacman.no_confirm is defined
    - pacman.no_confirm | bool
  tags:
    - pacman

# Removed state-based behavior - only configure when requested

# REQ-OS-021b: Pacman Multilib Repository Configuration
- name: Configure Pacman multilib repository
  ansible.builtin.lineinfile:
    path: /etc/pacman.conf
    regexp: "^#?\\[multilib\\]"
    line: "[multilib]"
    state: present
  become: true
  when:
    - pacman.multilib is defined
    - pacman.multilib.enabled is defined
    - pacman.multilib.enabled | bool
  tags:
    - pacman

- name: Configure Pacman multilib Include line
  ansible.builtin.lineinfile:
    path: /etc/pacman.conf
    regexp: "^#?Include = /etc/pacman.d/mirrorlist"
    line: "Include = /etc/pacman.d/mirrorlist"
    insertafter: "^\\[multilib\\]"
    state: present
  become: true
  when:
    - pacman.multilib is defined
    - pacman.multilib.enabled is defined
    - pacman.multilib.enabled | bool
  tags:
    - pacman
# Removed state-based behavior - only configure when requested
