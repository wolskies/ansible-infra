#SPDX-License-Identifier: MIT
---
- name: restart timesyncd
  ansible.builtin.systemd:
    name: systemd-timesyncd
    state: restarted
  become: true
  when: ansible_virtualization_type | default('') != 'docker'
  failed_when: false

- name: restart journald
  ansible.builtin.systemd:
    name: systemd-journald
    state: restarted
  become: true
  when: ansible_virtualization_type | default('') != 'docker'
  failed_when: false

- name: restart cfprefsd
  ansible.builtin.command: killall cfprefsd
  become: true
  when: ansible_distribution == 'MacOSX'
  failed_when: false

- name: reload udev
  ansible.builtin.command: udevadm control --reload-rules && udevadm trigger
  become: true
  when: ansible_system == 'Linux'
  failed_when: false

- name: Update mkinitcpio
  ansible.builtin.command: mkinitcpio -P
  become: true
  when:
    - ansible_distribution == 'Archlinux'
    - ansible_virtualization_type | default('') != 'docker'
  failed_when: false

- name: Update initramfs
  ansible.builtin.command: update-initramfs -u
  become: true
  when:
    - ansible_os_family == 'Debian'
    - ansible_virtualization_type | default('') != 'docker'
  failed_when: false
