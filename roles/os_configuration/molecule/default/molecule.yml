---
dependency:
  name: galaxy
driver:
  name: docker
platforms:
  # Consolidated test containers - comprehensive coverage with fewer resources
  - name: ubuntu-full-positive
    image: geerlingguy/docker-ubuntu2404-ansible:latest
    pre_build_image: true
    privileged: true
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:rw
    cgroupns_mode: host
    command: "/lib/systemd/systemd"
  - name: ubuntu-partial-enabled
    image: geerlingguy/docker-ubuntu2404-ansible:latest
    pre_build_image: true
    privileged: true
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:rw
    cgroupns_mode: host
    command: "/lib/systemd/systemd"
  - name: ubuntu-negative-empty
    image: geerlingguy/docker-ubuntu2404-ansible:latest
    pre_build_image: true
    privileged: true
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:rw
    cgroupns_mode: host
    command: "/lib/systemd/systemd"
  - name: ubuntu-negative-undefined
    image: geerlingguy/docker-ubuntu2404-ansible:latest
    pre_build_image: true
    privileged: true
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:rw
    cgroupns_mode: host
    command: "/lib/systemd/systemd"
  - name: ubuntu-edge-cases
    image: geerlingguy/docker-ubuntu2404-ansible:latest
    pre_build_image: true
    privileged: true
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:rw
    cgroupns_mode: host
    command: "/lib/systemd/systemd"
provisioner:
  name: ansible
  config_options:
    defaults:
      remote_tmp: /tmp/ansible-remote-tmp
      local_tmp: /tmp/ansible-local-tmp
      host_key_checking: false
      stdout_callback: ansible.builtin.default
      stdout_callback_format: yaml
  ansible_args:
    - --skip-tags
    - no-container
  inventory:
    group_vars:
      all:
        ansible_user: root
        molecule_test: true
        # OS configuration testing variables
        domain_name: "test.example.com"
        domain_timezone: "America/New_York"
        domain_locale: "en_US.UTF-8"
        domain_language: "en_US.UTF-8"
        domain_ntp:
          enabled: true
          servers:
            - 0.pool.ntp.org
            - 1.pool.ntp.org
    host_vars:
      # Consolidated test containers with comprehensive requirement coverage
      ubuntu-full-positive:
        # REQ-OS-001: Hostname configuration - positive test
        host_hostname: "test-hostname-full"
        host_update_hosts: true
        # REQ-OS-002: /etc/hosts update - positive test
        domain_name: "test.example.com"
        # REQ-OS-003: Timezone configuration - positive test
        domain_timezone: "America/New_York"
        # REQ-OS-004: Security hardening - positive test
        host_security:
          hardening_enabled: true
        # REQ-OS-005: SSH hardening - positive test (enabled in ubuntu-partial-enabled)
        # REQ-OS-006: System locale - positive test
        domain_locale: "en_US.UTF-8"
        # REQ-OS-008: NTP synchronization - positive test
        domain_ntp:
          enabled: true
          servers:
            - "0.pool.ntp.org"
            - "1.pool.ntp.org"
        # REQ-OS-009: Journal configuration - positive test
        journal:
          configure: true
          max_size: "100M"
          max_retention: "7d"
        # REQ-OS-011: Systemd unit control - mixed operations test
        host_services:
          enable:
            - "rsyslog"
            - "auditd"
          disable:
            - "debug-shell"
          mask:
            - "snapd"
        # REQ-OS-014: Kernel module management - mixed operations test
        host_modules:
          load:
            - "br_netfilter"
            - "overlay"
          blacklist:
            - "pcspkr"
            - "snd_pcsp"
        # REQ-OS-016: Custom udev rules - positive test
        host_udev:
          rules:
            - name: "test-usb-device"
              priority: 50
              content: 'SUBSYSTEM=="usb", ATTR{idVendor}=="1234", ATTR{idProduct}=="5678", MODE="0666"'
              state: present
            - name: "test-network-device"
              priority: 60
              content: 'SUBSYSTEM=="net", ACTION=="add", ATTRS{address}=="aa:bb:cc:dd:ee:ff", NAME="testnet0"'
              state: present
        # REQ-OS-017a: APT no-recommends - positive test
        apt:
          no_recommends: true
          # REQ-OS-018: APT unattended upgrades - positive test
          unattended_upgrades:
            enabled: true
      ubuntu-partial-enabled:
        # REQ-OS-001: Hostname - positive test
        host_hostname: "partial-test"
        host_update_hosts: false
        # REQ-OS-002: /etc/hosts - disabled test
        domain_name: "example.com"
        # REQ-OS-003: Timezone - positive test
        domain_timezone: "UTC"
        # REQ-OS-004: Security hardening - disabled test
        host_security:
          hardening_enabled: false
          # REQ-OS-005: SSH hardening - positive test
          ssh_hardening_enabled: true
        # REQ-OS-006: Locale - positive test
        domain_locale: "en_US.UTF-8"
        # REQ-OS-008: NTP - disabled test
        domain_ntp:
          enabled: false
          servers:
            - "pool.ntp.org"
        # REQ-OS-009: Journal - disabled test
        journal:
          configure: false
          max_size: "50M"
          max_retention: "3d"
        # REQ-OS-011: Systemd unit control - enable only test
        host_services:
          enable:
            - "rsyslog"
        # REQ-OS-014: Kernel module management - load only test
        host_modules:
          load:
            - "br_netfilter"
        # REQ-OS-017: APT proxy - positive test
        apt:
          proxy: "http://testuser:testpass@proxy.example.com:8080"
      ubuntu-negative-empty:
        # REQ-OS-001: Hostname - empty value test
        host_hostname: ""
        host_update_hosts: false
        # REQ-OS-002: /etc/hosts - no domain test
        # domain_name intentionally undefined
        # REQ-OS-003: Timezone - empty value test
        domain_timezone: ""
        # REQ-OS-004: Security hardening - disabled test
        host_security:
          hardening_enabled: false
          # REQ-OS-005: SSH hardening - disabled test
          ssh_hardening_enabled: false
        # REQ-OS-006: Locale - empty value test
        domain_locale: ""
        # REQ-OS-008: NTP - enabled but functional test
        domain_ntp:
          enabled: true
          servers:
            - "2.pool.ntp.org"
        # REQ-OS-009: Journal - enabled test
        journal:
          configure: true
          max_size: "200M"
          max_retention: "14d"
        # REQ-OS-011: Systemd unit control - disable/mask test
        host_services:
          disable:
            - "debug-shell"
          mask:
            - "snapd"
        # REQ-OS-014: Kernel module management - blacklist only test
        host_modules:
          blacklist:
            - "pcspkr"
      ubuntu-negative-undefined:
        # REQ-OS-001: Hostname - undefined test
        host_update_hosts: false
        # host_hostname intentionally undefined
        # REQ-OS-002: /etc/hosts - no hostname test
        domain_name: "undefined.example.com"
        # REQ-OS-003: Timezone - undefined test
        # domain_timezone intentionally undefined
        # REQ-OS-004 & REQ-OS-005: Security - default behavior test
        # host_security intentionally undefined
        # REQ-OS-006: Locale - undefined test
        # domain_locale intentionally undefined
        # REQ-OS-008: NTP - undefined test
        # domain_ntp intentionally undefined
        # REQ-OS-009: Journal - undefined test
        # journal intentionally undefined
        # REQ-OS-011: Systemd unit control - undefined test
        # host_services intentionally undefined
        # REQ-OS-014: Kernel module management - undefined test
        # host_modules intentionally undefined
      ubuntu-edge-cases:
        # REQ-OS-001: Hostname - special characters test
        host_hostname: "edge-test-123"
        host_update_hosts: true
        # REQ-OS-002: /etc/hosts - complex domain test
        domain_name: "complex.multi.level.example.org"
        # REQ-OS-003: Timezone - complex timezone test
        domain_timezone: "Europe/Amsterdam"
        # REQ-OS-004: Security - enabled with edge case
        host_security:
          hardening_enabled: true
          # REQ-OS-005: SSH hardening - disabled edge case
          ssh_hardening_enabled: false
        # REQ-OS-006: Locale - alternative locale test
        domain_locale: "de_DE.UTF-8"
        # REQ-OS-008: NTP - multiple servers test
        domain_ntp:
          enabled: true
          servers:
            - "3.pool.ntp.org"
            - "time.google.com"
            - "time.cloudflare.com"
        # REQ-OS-009: Journal - large values test
        journal:
          configure: true
          max_size: "1G"
          max_retention: "30d"
        # REQ-OS-011: Systemd unit control - empty arrays test
        host_services:
          enable: []
          disable: []
          mask: []
        # REQ-OS-014: Kernel module management - empty arrays test
        host_modules:
          load: []
          blacklist: []
        # REQ-OS-016: Custom udev rules - rule removal test
        host_udev:
          rules:
            - name: "test-remove-rule"
              priority: 70
              content: 'SUBSYSTEM=="block", ACTION=="add", MODE="0644"'
              state: absent
        # REQ-OS-017/017a/018: APT - state removal test (false/disabled)
        apt:
          proxy: "" # Empty string should remove proxy
          no_recommends: false # Should remove no-recommends config
          unattended_upgrades:
            enabled: false # Should remove unattended upgrades config
verifier:
  name: ansible
