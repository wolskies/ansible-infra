dependency:
  name: galaxy
driver:
  name: docker
platforms:
  - name: ubuntu-full-positive
    image: geerlingguy/docker-ubuntu2404-ansible:latest
    pre_build_image: true
    privileged: true
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:rw
    cgroupns_mode: host
    command: /lib/systemd/systemd
    tmpfs:
      - /tmp:rw,exec,size=1g,mode=1777
      - /run:rw,exec,size=100m
  - name: ubuntu-partial-enabled
    image: geerlingguy/docker-ubuntu2404-ansible:latest
    pre_build_image: true
    privileged: true
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:rw
    cgroupns_mode: host
    command: /lib/systemd/systemd
    tmpfs:
      - /tmp:rw,exec,size=1g,mode=1777
      - /run:rw,exec,size=100m
  - name: ubuntu-negative-empty
    image: geerlingguy/docker-ubuntu2404-ansible:latest
    pre_build_image: true
    privileged: true
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:rw
    cgroupns_mode: host
    command: /lib/systemd/systemd
    tmpfs:
      - /tmp:rw,exec,size=1g,mode=1777
      - /run:rw,exec,size=100m
  - name: ubuntu-negative-undefined
    image: geerlingguy/docker-ubuntu2404-ansible:latest
    pre_build_image: true
    privileged: true
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:rw
    cgroupns_mode: host
    command: /lib/systemd/systemd
    tmpfs:
      - /tmp:rw,exec,size=1g,mode=1777
      - /run:rw,exec,size=100m
  - name: ubuntu-edge-cases
    image: geerlingguy/docker-ubuntu2404-ansible:latest
    pre_build_image: true
    privileged: true
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:rw
    cgroupns_mode: host
    command: /lib/systemd/systemd
    tmpfs:
      - /tmp:rw,exec,size=1g,mode=1777
      - /run:rw,exec,size=100m
  - name: arch-ntp-test
    image: carlodepieri/docker-archlinux-ansible:latest
    pre_build_image: true
    privileged: true
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:rw
    cgroupns_mode: host
    command: /usr/lib/systemd/systemd
    env:
      container: docker
    tmpfs:
      - /tmp:rw,exec,size=1g,mode=1777
      - /run:rw,exec,size=100m
provisioner:
  name: ansible
  config_options:
    defaults:
      remote_tmp: /tmp/ansible-remote-tmp
      local_tmp: /tmp/ansible-local-tmp
      host_key_checking: false
      stdout_callback: ansible.builtin.default
      stdout_callback_format: yaml
  ansible_args:
    - --skip-tags
    - no-container
  inventory:
    group_vars:
      all:
        ansible_user: root
        molecule_test: true
        domain_name: test.example.com
        domain_timezone: America/New_York
        domain_locale: en_US.UTF-8
        domain_language: en_US.UTF-8
        domain_timesync:
          enabled: true
          servers:
            - 0.pool.ntp.org
            - 1.pool.ntp.org
    host_vars:
      ubuntu-full-positive:
        host_hostname: test-hostname-full
        host_update_hosts: true
        domain_name: test.example.com
        domain_timezone: America/New_York
        host_security:
          hardening_enabled: true
        domain_locale: en_US.UTF-8
        domain_timesync:
          enabled: true
          servers:
            - 0.pool.ntp.org
            - 1.pool.ntp.org
        journal:
          configure: true
          max_size: 100M
          max_retention: 7d
        host_services:
          enable:
            - rsyslog
            - auditd
          disable:
            - debug-shell
          mask:
            - snapd
        host_modules:
          load:
            - br_netfilter
            - overlay
          blacklist:
            - pcspkr
            - snd_pcsp
        host_udev_rules:
          - name: test-usb-device
            priority: 50
            content: SUBSYSTEM=="usb", ATTR{idVendor}=="1234", ATTR{idProduct}=="5678",
              MODE="0666"
            state: present
          - name: test-network-device
            priority: 60
            content: SUBSYSTEM=="net", ACTION=="add", ATTRS{address}=="aa:bb:cc:dd:ee:ff",
              NAME="testnet0"
            state: present
        apt:
          no_recommends: true
          unattended_upgrades:
            enabled: true
      ubuntu-partial-enabled:
        host_hostname: partial-test
        host_update_hosts: false
        domain_name: example.com
        domain_timezone: UTC
        host_security:
          hardening_enabled: false
          ssh_hardening_enabled: true
        domain_locale: en_US.UTF-8
        domain_timesync:
          enabled: false
          servers:
            - pool.ntp.org
        journal:
          configure: false
          max_size: 50M
          max_retention: 3d
        host_services:
          enable:
            - rsyslog
        host_modules:
          load:
            - br_netfilter
        apt:
          proxy: http://testuser:testpass@proxy.example.com:8080
      ubuntu-negative-empty:
        host_hostname: ""
        host_update_hosts: false
        domain_timezone: ""
        host_security:
          hardening_enabled: false
          ssh_hardening_enabled: false
        domain_locale: ""
        domain_timesync:
          enabled: true
          servers:
            - 2.pool.ntp.org
        journal:
          configure: true
          max_size: 200M
          max_retention: 14d
        host_services:
          disable:
            - debug-shell
          mask:
            - snapd
        host_modules:
          blacklist:
            - pcspkr
      ubuntu-negative-undefined:
        host_update_hosts: false
        domain_name: undefined.example.com
      ubuntu-edge-cases:
        host_hostname: edge-test-123
        host_update_hosts: true
        domain_name: complex.multi.level.example.org
        domain_timezone: Europe/Amsterdam
        host_security:
          hardening_enabled: true
          ssh_hardening_enabled: false
        domain_locale: de_DE.UTF-8
        domain_timesync:
          enabled: true
          servers:
            - 3.pool.ntp.org
            - time.google.com
            - time.cloudflare.com
        journal:
          configure: true
          max_size: 1G
          max_retention: 30d
        host_services:
          enable: []
          disable: []
          mask: []
        host_modules:
          load: []
          blacklist: []
        host_udev_rules:
          - name: test-remove-rule
            priority: 70
            content: SUBSYSTEM=="block", ACTION=="add", MODE="0644"
            state: absent
        apt:
          proxy: ""
          no_recommends: false
          unattended_upgrades:
            enabled: false
      arch-ntp-test:
        ansible_remote_tmp: /tmp/.ansible-${USER}/tmp
        host_hostname: arch-ntp
        domain_name: arch.test.example.com
        domain_timezone: America/New_York
        domain_timesync:
          enabled: true
          servers:
            - 0.pool.ntp.org
            - 1.pool.ntp.org
        pacman:
          no_confirm: false
          multilib:
            enabled: false
verifier:
  name: ansible
