#SPDX-License-Identifier: MIT-0
---
# defaults file for gitlab
# GitLab Docker Service Configuration

# Basic service configuration
gitlab_hostname: 'gitlab'
gitlab_domain: 'example.com'
gitlab_service_dir: "{{ docker_services_dir | default('/opt/docker-services') }}/gitlab"

# Docker configuration
gitlab_docker_network: "services"
gitlab_create_network: true
gitlab_pull_images: true
gitlab_recreate_containers: "smart"
gitlab_wait_for_ready: true

# Deployment settings
gitlab_configure_firewall: false
gitlab_nginx_proxy: false
gitlab_letsencrypt: false
gitlab_smtp_enable: true
gitlab_smtp_address: "smtp.example.com"
gitlab_smtp_port: 587
gitlab_smtp_user_name: "user@example.com"
gitlab_smtp_password: "changeme"
gitlab_smtp_domain: "smtp.example.com"
gitlab_smtp_enable_starttls_auto: true
gitlab_shell_ssh_port: 2222
gitlab_registry_enabled: false
gitlab_registry_host: "registry.example.com"
gitlab_registry_port: 5050
gitlab_registry_path: "/var/opt/gitlab/gitlab-rails/shared/registry"
gitlab_nginx_listen_port: 80
gitlab_nginx_listen_https: false
gitlab_registry_url: 'https://registry.example.com'
gitlab_listen_https: false
gitlab_initial_root_password: "changemetoo"
gitlab_pages_local_store_enabled: false
gitlab_pages_local_store_path: "/var/opt/gitlab/gitlab-rails/shared/pages"
gitlab_backup_path: "/var/opt/gitlab/backups"
pages_external_url: "http://pages.example.com"
gitlab_pages_enable: false
gitlab_pages_listen_proxy: "localhost:8090"
gitlab_web_listen_port: 80
gitlab_websecure_listen_port: 443
gitlab_pages_listen_port: 8090
# Volume configuration (relative to service directory)
gitlab_volume_config: "{{ gitlab_service_dir }}/config"
gitlab_volume_logs: "{{ gitlab_service_dir }}/logs"
gitlab_volume_data: "{{ gitlab_service_dir }}/data"
gitlab_volume_secret: "{{ gitlab_service_dir }}/secret"
gitlab_backup_host_path: "{{ gitlab_service_dir }}/backups"

# Backup configuration
gitlab_create_backup_script: true
gitlab_schedule_backups: false
gitlab_backup_schedule: "0 2 * * 0"  # Weekly on Sunday at 2 AM
gitlab_firewall_ports:
  - rule: allow
    port: 80
    proto: tcp
    comment: 'Allow inbound HTTP traffic'
  - rule: allow
    port: 443
    proto: tcp
    comment: 'Allow inbound HTTPS traffic'
  - rule: allow
    port: 8080
    proto: tcp
    comment: 'Allow access to GitLab Web Interface'
  # - rule: allow
  #   port: 5050
  #   proto: tcp
  #   comment: 'Allow access to GitLab Repository'
  - rule: allow
    port: 22
    proto: tcp
    comment: 'Allow SSH access to GitLab'
  # - rule: allow
  #   port: 8090
  #   proto: tcp
  #   comment: 'Allow access to GitLab Pages'
