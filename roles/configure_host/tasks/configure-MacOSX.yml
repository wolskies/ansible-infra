---
# macOS (Darwin) host configuration tasks
# Platform-unique features only - common tasks handled in main.yml

# NOTE: Xcode Command Line Tools are required for Ansible to function on macOS
# They must be installed manually before running this collection:
# xcode-select --install

# macOS System Preferences
- name: Configure macOS Dock
  block:
    - name: Set Dock size
      community.general.osx_defaults:
        domain: com.apple.dock
        key: tilesize
        type: int
        value: "{{ config_macos_dock_tile_size }}"

    - name: Set Dock position
      community.general.osx_defaults:
        domain: com.apple.dock
        key: orientation
        type: string
        value: "{{ config_macos_dock_position }}"

    - name: Restart Dock to apply changes
      ansible.builtin.command: killall Dock
      changed_when: false

  when: config_macos_configure_dock | default(true)
  tags:
    - macos
    - dock
    - preferences

# macOS Firewall configuration
- name: Enable macOS firewall
  ansible.builtin.command: /usr/libexec/ApplicationFirewall/socketfilterfw --setglobalstate on
  become: true
  when:
    - configure_firewall | default(true)
    - enable_firewall | default(true)
  changed_when: false
  tags:
    - firewall
    - security
    - macos

- name: Configure macOS automatic updates
  community.general.osx_defaults:
    domain: /Library/Preferences/com.apple.SoftwareUpdate
    key: "{{ item.key }}"
    type: bool
    value: "{{ item.value }}"
  loop:
    - { key: "AutomaticCheckEnabled", value: "{{ not config_macos_disable_auto_updates | default(false) }}" }
    - { key: "AutomaticDownload", value: "{{ not config_macos_disable_auto_updates | default(false) }}" }
  become: true
  when: config_macos_configure_system | default(true)
  tags:
    - macos
    - updates
    - system
