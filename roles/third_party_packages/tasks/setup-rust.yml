---
# Rust package installation via cargo
# Future implementation for cargo install packages

- name: Ensure Rust and cargo are available
  ansible.builtin.command: "cargo --version"
  register: cargo_check
  changed_when: false
  failed_when: cargo_check.rc != 0
  tags:
    - rust
    - prerequisites

- name: Install Rust packages
  ansible.builtin.command: "cargo install {{ item }}"
  loop: "{{ rust_packages }}"
  register: cargo_install
  changed_when: "'Installed' in cargo_install.stdout"
  failed_when: cargo_install.rc != 0 and 'already exists' not in cargo_install.stderr
  tags:
    - rust
    - cargo-install

- name: Display Rust packages summary
  ansible.builtin.debug:
    msg:
      - "Rust packages installed: {{ rust_packages | length }}"
      - "Installation location: ~/.cargo/bin"
  tags:
    - rust
    - summary