---
argument_specs:
  main:
    short_description: Security services management role
    description: |
      Handles firewall configuration and intrusion prevention services across
      Linux and macOS systems. Uses UFW on Linux and Application Layer Firewall
      on macOS.
    options:
      # Firewall Configuration
      firewall:
        type: dict
        default: {}
        description: Firewall configuration settings
        options:
          enabled:
            type: bool
            default: false
            description: Enable firewall rule management
          prevent_ssh_lockout:
            type: bool
            default: true
            description: Automatically allow SSH during firewall configuration
          rules:
            type: list
            elements: dict
            default: []
            description: Firewall rule definitions
            options:
              port:
                type: raw
                required: false
                description: Port number or range (e.g., 22, "8080:8090")
              protocol:
                type: str
                default: "tcp"
                choices: ["tcp", "udp", "any"]
                description: Protocol
              rule:
                type: str
                default: "allow"
                choices: ["allow", "deny"]
                description: Rule action
              source:
                type: str
                default: "any"
                description: Source IP/CIDR (e.g., "192.168.1.0/24", "any")
              destination:
                type: str
                default: "any"
                description: Destination IP/CIDR
              comment:
                type: str
                default: ""
                description: Rule description
          # macOS-specific firewall options
          stealth_mode:
            type: bool
            default: false
            description: Enable stealth mode on macOS Application Layer Firewall (don't respond to pings)
          block_all:
            type: bool
            default: false
            description: Block all incoming connections on macOS (except essential services)
          logging:
            type: bool
            default: false
            description: Enable firewall logging on macOS Application Layer Firewall

      # Fail2ban Configuration
      fail2ban:
        type: dict
        default: {}
        description: Fail2ban intrusion prevention configuration
        options:
          enabled:
            type: bool
            default: false
            description: Enable fail2ban intrusion prevention service on Linux systems
          bantime:
            type: str
            default: "10m"
            description: Duration for which IP is banned (e.g., "10m", "1h", "1d")
          findtime:
            type: str
            default: "10m"
            description: Time window for counting failures (e.g., "10m", "1h")
          maxretry:
            type: int
            default: 5
            description: Number of failures before IP is banned
          jails:
            type: list
            elements: dict
            default: []
            description: Fail2ban jail configurations
            options:
              name:
                type: str
                required: true
                description: Jail name (e.g., "sshd", "apache-auth", "nginx-http-auth")
              enabled:
                type: bool
                default: true
                description: Whether this jail is active
              port:
                type: str
                required: false
                description: Port(s) to monitor (e.g., "ssh", "http,https", "22")
              filter:
                type: str
                required: false
                description: Filter name to use (defaults to jail name)
              logpath:
                type: str
                required: true
                description: Log file path to monitor (e.g., "/var/log/auth.log")
              maxretry:
                type: int
                required: false
                description: Override global maxretry for this jail
              bantime:
                type: str
                required: false
                description: Override global bantime for this jail (e.g., "1h", "1d")
              findtime:
                type: str
                required: false
                description: Override global findtime for this jail
              action:
                type: str
                default: "iptables"
                description: Ban action (e.g., "iptables", "iptables-multiport", "ufw")
