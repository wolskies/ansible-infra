# Fail2Ban configuration
# Generated by wolskies.infrastructure.manage_security_services role

[DEFAULT]
# Ban hosts for default time:
bantime = {{ fail2ban.bantime | default('10m') }}

# Override /etc/fail2ban/jail.d/00-firewalld.conf:
banaction = iptables-multiport

# Default failure detection settings
findtime = {{ fail2ban.findtime | default('10m') }}
maxretry = {{ fail2ban.maxretry | default(5) }}

{% for jail in fail2ban.jails | default([]) %}
{% if jail.enabled | default(false) %}
[{{ jail.name }}]
enabled = true
maxretry = {{ jail.maxretry | default(fail2ban.maxretry | default(5)) }}
{% if jail.bantime is defined %}
bantime = {{ jail.bantime }}
{% else %}
bantime = {{ fail2ban.bantime | default('10m') }}
{% endif %}
{% if jail.findtime is defined %}
findtime = {{ jail.findtime }}
{% else %}
findtime = {{ fail2ban.findtime | default('10m') }}
{% endif %}
{% if jail.logpath is defined %}
logpath = {{ jail.logpath }}
{% endif %}
{% if jail.port is defined %}
port = {{ jail.port }}
{% endif %}
{% if jail.filter is defined %}
filter = {{ jail.filter }}
{% endif %}
{% endif %}

{% endfor %}
