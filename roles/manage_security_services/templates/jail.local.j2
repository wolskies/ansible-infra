# Fail2Ban configuration
# Generated by wolskies.infrastructure.manage_security_services role

[DEFAULT]
# Ban hosts for default time:
bantime = {{ fail2ban.defaults.bantime }}

# Override /etc/fail2ban/jail.d/00-firewalld.conf:
banaction = iptables-multiport

# Default failure detection settings
findtime = {{ fail2ban.defaults.findtime }}
maxretry = {{ fail2ban.defaults.maxretry }}

# Ignore local IPs
ignoreip = {{ fail2ban.ignoreips | join(' ') }}

# Email settings (disabled by default)
#mta = sendmail
#action = %(action_)s
{% if fail2ban.dest_email != "" %}
#destemail = {{ fail2ban.dest_email }}
{% endif %}

{% for service in fail2ban.services %}
{% if service.enabled %}
[{{ service.name }}]
enabled = true
maxretry = {{ service.maxretry | default(fail2ban.defaults.maxretry) }}
{% if service.bantime is defined %}
bantime = {{ service.bantime }}
{% else %}
bantime = {{ fail2ban.defaults.bantime }}
{% endif %}
{% if service.findtime is defined %}
findtime = {{ service.findtime }}
{% else %}
findtime = {{ fail2ban.defaults.findtime }}
{% endif %}
{% if service.logpath is defined %}
logpath = {{ service.logpath }}
{% endif %}
{% endif %}

{% endfor %}
