---
# Simple test to generate host vars template
- name: Test discovery template generation
  hosts: localhost
  gather_facts: true
  connection: local
  
  vars:
    discovery_profile:
      hostname: "test-localhost"
      system:
        os_family: "Archlinux"
        distribution: "Archlinux"
        distribution_version: "rolling"
        architecture: "x86_64"
        python_version: "3.13.5"
        total_memory: 8192
        cpu_cores: 4
      network:
        default_ipv4:
          interface: "eth0"
          address: "127.0.0.1"
        fqdn: "localhost"
      packages:
        installed:
          - "git 2.43"
          - "python3 3.13"
          - "curl 8.5"
          - "vim 9.0"
          - "docker 24.0"
        homebrew_formulae: []
        homebrew_casks: []
        aur_packages:
          - "ansible-dev-environment 25.5.0-1"
          - "jetbrains-toolbox 2.8.0.51430-1"
          - "makepasswd 1.10_12-1"
          - "mongosh 2.3.9-1"
          - "paru 2.1.0-1"
          - "paru-debug 2.0.4-1"
          - "phonon-qt6-mpv 0.1.0-3"
          - "visual-studio-code-bin 1.103.0-1"
      docker:
        installed: true
      users:
        current_user: "ed"
        current_shell: "/bin/zsh"
      dotfiles:
        detected: true
        remote_url: "git@github.com:edwolskinet/dotfiles.git"
  
  tasks:
    - name: Create directories
      ansible.builtin.file:
        path: "{{ item }}"
        state: directory
      loop:
        - "./inventory/host_vars"
        - "./playbooks"
        
    - name: Generate test host vars
      ansible.builtin.template:
        src: "../roles/discovery/templates/discovered-host-vars.yml.j2"
        dest: "./inventory/host_vars/test-localhost.yml"
        
    - name: Generate test playbook  
      ansible.builtin.template:
        src: "../roles/discovery/templates/discovered-playbook.yml.j2"
        dest: "./playbooks/deploy-test-localhost.yml"
        
    - name: Display generated files
      ansible.builtin.debug:
        msg:
          - "Generated files:"
          - "  - inventory/host_vars/test-localhost.yml"
          - "  - playbooks/deploy-test-localhost.yml"